<?php

namespace Brasa\InventarioBundle\Repository;

use Doctrine\ORM\EntityRepository;

/**
 * InvCierreMesLoteRepository
 *
 * This class was generated by the Doctrine ORM. Add your own custom
 * repository methods below.
 */
class InvCierreMesLoteRepository extends EntityRepository
{
    public function AsigarDatosLotesCierreALotes ($intCodigoCierreMes, $intCodigoItem) {
        $em = $this->getEntityManager();
        $arCierreMesLotes = new \Brasa\InventarioBundle\Entity\InvCierreMesLote();
        $arCierreMesLotes = $em->getRepository('BrasaInventarioBundle:InvCierreMesLote')->findBy(array('codigoCierreMesFk' => $intCodigoCierreMes, 'codigoItemFk' => $intCodigoItem));
        foreach ($arCierreMesLotes as $arCierreMesLotes) {
            $arLoteAct = new \Brasa\InventarioBundle\Entity\InvLote();
            $arLoteAct = $em->getRepository('BrasaInventarioBundle:InvLote')->find(array('codigoItemFk' => $arCierreMesLotes->getCodigoItemFk(), 'codigoBodegaFk' => $arCierreMesLotes->getCodigoBodegaFk(), 'loteFk' => $arCierreMesLotes->getLoteFk()));                            
            if(count($arLoteAct) > 0) {
                $arLoteAct->setExistencia($arCierreMesLotes->getExistencia());
            }
            $em->persist($arLoteAct);
            $em->flush();
        }        
    }
}